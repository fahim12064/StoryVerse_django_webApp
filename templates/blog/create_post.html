{% extends 'base.html' %}
{% block title %}Create Post - StoryVerse{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mt-10">
    <h1 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Create a New Post</h1>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="mb-4">
            <label for="id_title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
            {{ form.title }}
            {% if form.title.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.title.errors.0 }}</p>
            {% endif %}
        </div>
        
        <div class="mb-4">
            <label for="id_content" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Content</label>
            {{ form.content }}
            {% if form.content.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.content.errors.0 }}</p>
            {% endif %}
        </div>
        
        <div class="mb-4">
            <label for="id_cover_image" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cover Image (Optional)</label>
            {{ form.cover_image }}
            {% if form.cover_image.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.cover_image.errors.0 }}</p>
            {% else %}
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">JPG, GIF or PNG. Max size 5MB.</p>
            {% endif %}
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label for="id_category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                {{ form.category }}
                {% if form.category.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ form.category.errors.0 }}</p>
                {% endif %}
            </div>
            
            <div>
                <label for="id_subcategory" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Subcategory</label>
                {{ form.subcategory }}
                {% if form.subcategory.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ form.subcategory.errors.0 }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="flex justify-end space-x-3">
            <a href="{% url 'home' %}" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition">Cancel</a>
            <button type="submit" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition">Publish Post</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const categorySelect = document.getElementById('id_category');
        const subcategorySelect = document.getElementById('id_subcategory');
        
        categorySelect.addEventListener('change', function() {
            const categoryId = this.value;
            
            // Clear subcategory options
            subcategorySelect.innerHTML = '<option value="">---------</option>';
            
            if (categoryId) {
                // Fetch subcategories for the selected category
                fetch(`/api/subcategories/?category_id=${categoryId}`)
                    .then(response => response.json())
                    .then(data => {
                        data.subcategories.forEach(subcategory => {
                            const option = document.createElement('option');
                            option.value = subcategory.id;
                            option.textContent = subcategory.name;
                            subcategorySelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching subcategories:', error);
                    });
            }
        });
    });
</script>
{% endblock %}